<!DOCTYPE html>
<html>
<head>
  <title>Free Earnings App</title>
  <style>
    /* --- Base Styles --- */
    body { font-family: Arial, sans-serif; margin:0; background:#0d0d0d; color:#fff; line-height: 1.6; }
    header { background: linear-gradient(to right, #0ff, #0cc); color:#000; padding:15px; text-align:center; font-size:24px; font-weight:bold; text-shadow:0 0 5px #0ff; box-shadow: 0 2px 5px rgba(0,255,255,0.3); }
    nav { display:flex; flex-wrap:wrap; justify-content:center; background:#111; padding:10px 0; border-bottom: 2px solid #0ff; }
    nav button { background: #fff; border: none; padding: 10px 15px; margin: 5px; color: #000; font-weight:bold; border-radius: 8px; cursor:pointer; transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
    nav button:hover { box-shadow: 0 0 15px #0ff, 0 4px 8px rgba(0,0,0,0.3); transform: translateY(-2px); background: #f0f0f0; }
    nav button[data-section="adminPanel"] { background: #ffc107; color: #000; } /* Admin button style */
    nav button[data-section="adminPanel"]:hover { background: #e0a800; box-shadow: 0 0 15px #e0a800, 0 4px 8px rgba(0,0,0,0.3); }

    section { display:none; padding:20px; margin-top: 20px; }
    section.active { display:block; }

    /* --- Input and Buttons --- */
    input[type="text"], input[type="email"], input[type="password"], input[type="number"], select, textarea {
        padding: 10px; margin: 8px 0; border-radius: 8px; border: 1px solid #333; width: 100%; box-sizing: border-box; background-color: #222; color: #fff; font-size: 14px;
    }
    input:focus, select:focus, textarea:focus { border-color: #0ff; outline: none; box-shadow: 0 0 8px rgba(0, 255, 255, 0.5); }

    button.submitBtn {
        background: #0ff; color: #000; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; font-size: 16px;
        display: inline-block;
        margin-top: 10px;
    }
    button.submitBtn:hover { box-shadow: 0 0 10px #0ff, 0 4px 8px rgba(0,255,255,0.3); background: #fff; color: #000; transform: translateY(-2px); }
    button.submitBtn:disabled { background: #555; color: #aaa; cursor: not-allowed; box-shadow: none; transform: none; }
    
    /* --- Full Screen Auth Section --- */
    #authSection {
        position: fixed; /* Use fixed position */
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.9); /* Darker background for full screen */
        display: flex; /* Use flexbox for centering */
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 999; /* Ensure it's above other content */
        padding: 20px;
        box-sizing: border-box;
    }
    #authSection .auth-container { /* New container for centering form */
        max-width: 400px;
        width: 100%; /* Full width up to max-width */
        padding: 30px;
        background: rgba(17, 17, 17, 0.8);
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0,255,255,0.2);
        text-align: center;
    }
    #authSection h2 { color: #0ff; margin-bottom: 25px; }
    #authSection hr { border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 255, 255, 0), rgba(0, 255, 255, 0.75), rgba(0, 255, 255, 0)); margin: 30px 0; }
    #authSection button.submitBtn { width: 100%; }

    /* --- Containers for Boxes --- */
    .dashboard-container, #tasksContainer, #withdrawList, #adminTasksContainer, #adminLinksContainer, #depositList, #userLinksContainer { /* Added userLinksContainer */
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px; /* Increased gap */
        margin-top: 25px;
    }

    /* --- Individual Boxes (Dashboard, Task, Withdraw, Link, Deposit History) --- */
    .dashboard-box, .taskBox, .withdrawBox, .linkBox, .depositBox, .userLinkBox { /* Added .userLinkBox */
        background: #1a1a1a; /* Darker background */
        padding: 20px;
        border-radius: 12px; /* More rounded corners */
        box-shadow: 0 5px 15px rgba(0, 255, 255, 0.15); /* Softer glow */
        min-width: 220px; /* Consistent min-width */
        text-align: center;
        flex-grow: 1;
        max-width: 280px; /* Consistent max-width */
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .dashboard-box:hover, .taskBox:hover, .withdrawBox:hover, .linkBox:hover, .depositBox:hover, .userLinkBox:hover { /* Added hover for depositBox and userLinkBox */
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 255, 255, 0.3);
    }
    .taskBox p { margin-bottom: 15px; font-size: 15px; color: #ccc; }
    
    /* --- NEW STYLES FOR ADMIN PANEL --- */
    #adminPanel form {
        max-width: 600px;
        margin: 20px auto;
        background: #1a1a1a; /* Darker background */
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0, 255, 255, 0.2);
        border: 1px solid #333;
    }
    #adminPanel h2 {
        color: #0ff;
        text-align: center;
        margin-bottom: 25px;
        font-size: 28px;
    }
    #adminPanel input,
    #adminPanel select,
    #adminPanel textarea {
        background-color: #222;
        color: #fff;
        border: 1px solid #333;
        padding: 12px; /* Slightly larger padding */
    }
    #adminPanel input:focus,
    #adminPanel select:focus,
    #adminPanel textarea:focus {
        border-color: #0ff;
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.6);
    }
    #adminPanel .submitBtn {
        width: 100%;
        display: block;
        margin-top: 25px; /* More space above button */
    }
     /* Style for dynamically added link fields */
    .dynamic-link-input {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
    }
    .dynamic-link-input input {
        flex-grow: 1;
        margin-bottom: 0; /* Remove bottom margin for better alignment */
        padding: 10px; /* Consistent padding */
    }
    .dynamic-link-input button {
        background: #dc3545; /* Red for remove */
        color: white;
        border: none;
        padding: 10px 12px; /* Adjusted padding */
        border-radius: 6px; /* Slightly more rounded */
        cursor: pointer;
        font-size: 14px; /* Adjusted font size */
        transition: all 0.3s ease;
        flex-shrink: 0; /* Prevent button from shrinking */
    }
    .dynamic-link-input button:hover {
        background: #c82333;
        transform: translateY(-1px);
    }
    #adminPanel p { color: #ccc; margin-bottom: 10px; font-size: 13px; }

    /* --- Deposit Section Specific Styles --- */
    #deposit .deposit-info-box {
        background: #1a1a1a;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        border: 1px solid #333;
        text-align: left;
    }
    #deposit .deposit-info-box p { color: #ffc107; font-weight: bold; margin-bottom: 10px; }
    #deposit .deposit-info-box ul { padding-left: 20px; color: #ccc; }
    #deposit .deposit-info-box li { margin-bottom: 8px; }
    #deposit form { max-width: 500px; margin: 20px auto; padding: 25px; background: #1a1a1a; border-radius: 12px; box-shadow: 0 5px 15px rgba(0, 255, 255, 0.2); }
    #deposit h3 { margin-top: 30px; color: #0ff; text-align: center; }

    /* --- UPDATED FOOTER STYLE --- */
    footer {
        background:#111;
        padding: 15px 0;
        text-align:center;
        margin-top:40px;
        border-top:2px solid #0ff;
        width: 100%;
        height: auto; /* Changed from fixed height to auto */
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    .footer-links { display: flex; justify-content: center; gap: 25px; flex-wrap: wrap; margin-bottom: 10px; }
    .footer-links a { color: #0ff; text-decoration: none; font-weight: bold; cursor: pointer; white-space: nowrap; transition: color 0.3s ease; }
    .footer-links a:hover { text-decoration: underline; color: #fff; }
    footer .copyright { font-size:13px; color:#aaa; margin:0; }

    /* --- Modal Styles --- */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.8); /* Darker modal background */
        backdrop-filter: blur(5px); /* Slight blur effect */
    }
    .modal-content {
        background-color: #1a1a1a; /* Darker modal content */
        color: #fff;
        margin: 8% auto; /* Adjusted margin */
        padding: 30px 40px; /* Increased padding */
        border: 1px solid #0ff;
        border-radius: 12px; /* More rounded */
        width: 85%;
        max-width: 700px;
        box-shadow: 0 0 25px rgba(0, 255, 255, 0.4); /* Stronger glow */
        position: relative;
    }
    .modal-close-btn {
        color: #aaa; /* Softer close button color */
        position: absolute;
        top: 15px;
        right: 25px;
        font-size: 35px; /* Larger close icon */
        font-weight: bold;
        cursor: pointer;
        transition: color 0.3s ease;
    }
    .modal-close-btn:hover { color: #0ff; }
    .modal-content h2 { color: #0ff; text-align: center; margin-bottom: 20px; font-size: 30px;}
    .modal-content p { line-height: 1.7; text-align: left; }
    .modal-content ul { text-align: left; list-style-position: inside; padding-left: 10px;}
    .modal-content li { margin-bottom: 10px; }

    /* --- Specific Sections --- */
    #tasks { /* ... existing styles ... */ }

    /* --- Profile Section --- */
    .profile-card {
        background: #1a1a1a; /* Darker */
        padding: 30px; /* More padding */
        border-radius: 12px; /* More rounded */
        box-shadow: 0 5px 15px rgba(0, 255, 255, 0.2); /* Softer glow */
        max-width: 480px; /* Slightly wider */
        width: 90%;
        margin: 40px auto; /* More margin */
        text-align: center;
    }
    .profile-header { margin-bottom: 25px; }
    .profile-pic {
        width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid #0ff; /* Thicker border */
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.6); /* Brighter glow */
        background-color: #333; display: flex; justify-content: center; align-items: center; font-size: 45px; font-weight: bold; color: white;
    }
    .profile-info h2 { margin: 12px 0 6px 0; color: #0ff; font-size: 30px; }
    .profile-info p { margin: 6px 0; color: #ccc; font-size: 17px; }
    .profile-info p.referral-code { font-weight: bold; color: #fff; background: #2a2a2a; padding: 8px 15px; border-radius: 6px; display: inline-block; margin-top: 12px; font-size: 15px; }
    .profile-stats { margin: 30px 0; padding: 20px 0; border-top: 1px solid #333; border-bottom: 1px solid #333; display: flex; justify-content: space-around; }
    .stat-item p { margin: 0; color: #aaa; font-size: 15px; }
    .stat-item h3 { margin: 6px 0 0 0; color: #fff; font-size: 24px; font-weight: bold; }
    .profile-actions { margin-top: 25px; }
    .profile-actions button { background: #0ff; color: #000; border: none; padding: 14px 30px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; font-size: 17px; }
    .profile-actions button:hover { box-shadow: 0 0 10px #0ff, 0 4px 8px rgba(0,255,255,0.3); background: #fff; color: #000; transform: translateY(-2px); }

    /* --- Withdrawal/Deposit Status Styles --- */
    .status-pending, .status-pending-verification { color: #ffc107; font-weight: bold; } /* Yellow */
    .status-approved { color: #28a745; font-weight: bold; } /* Green */
    .status-rejected { color: #dc3545; font-weight: bold; } /* Red */

    /* --- YouTube Video Section --- */
    #youtubeVideoSection { text-align: center; margin-top: 30px; padding: 20px; background: #1a1a1a; border-radius: 12px; box-shadow: 0 5px 15px rgba(0, 255, 255, 0.15); }
    #youtubeVideoSection iframe { max-width: 100%; border: none; border-radius: 8px; }
    #youtubeVideoSection h2 { color: #0ff; margin-bottom: 20px; }
    #youtubeVideoSection p { color: #ccc; font-size: 15px; }

    /* --- User Added Links Section --- */
    #userLinksSection {
        margin-top: 30px;
        padding: 25px;
        background: #1a1a1a;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0, 255, 255, 0.15);
    }
    #userLinksSection h2 {
        color: #0ff;
        text-align: center;
        margin-bottom: 25px;
        font-size: 28px;
    }
    #userLinksSection form {
        max-width: 500px;
        margin: 0 auto 30px auto; /* Center form, add bottom margin */
        background: #222;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
        border: 1px solid #333;
    }
    #userLinksSection form label { display: block; margin-bottom: 5px; color: #ccc; font-size: 14px; }
    #userLinksSection form input[type="text"],
    #userLinksSection form input[type="url"] {
        background-color: #333; /* Darker input */
        border: 1px solid #444;
    }
    #userLinksSection form input[type="text"]:focus,
    #userLinksSection form input[type="url"]:focus {
        border-color: #0ff;
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    }
    .userLinkBox .edit-delete-buttons button {
        background: #ffc107; /* Yellow for edit */
        color: #000;
        margin-right: 5px;
        padding: 8px 12px;
        font-size: 13px;
    }
    .userLinkBox .edit-delete-buttons button.delete-btn {
        background: #dc3545; /* Red for delete */
        color: white;
    }
    .userLinkBox .edit-delete-buttons button:hover {
        opacity: 0.9;
        transform: translateY(-1px);
    }

    /* --- Responsive Adjustments --- */
    @media (max-width: 768px) {
        nav button { padding: 8px 12px; font-size: 13px; }
        .dashboard-container, #tasksContainer, #withdrawList, #adminTasksContainer, #adminLinksContainer, #depositList, #userLinksContainer {
            gap: 15px;
        }
        .dashboard-box, .taskBox, .withdrawBox, .linkBox, .depositBox, .userLinkBox {
            min-width: 180px;
            max-width: 45%; /* Allow two per row on smaller screens */
        }
        .modal-content { width: 90%; margin: 5% auto; }
        .profile-card { width: 95%; margin: 20px auto; }
        #deposit form { width: 90%; }
        #authSection .auth-container { margin: 20px auto; } /* Adjust margin for smaller screens */
        #userLinksSection form { width: 95%; }
    }
    @media (max-width: 480px) {
        header { font-size: 20px; padding: 12px; }
        nav { padding: 8px 0; }
        nav button { margin: 3px; padding: 8px 10px; font-size: 12px; }
        .dashboard-box, .taskBox, .withdrawBox, .linkBox, .depositBox, .userLinkBox {
            min-width: 150px;
            max-width: 100%; /* Full width on very small screens */
        }
        .modal-content h2 { font-size: 24px; }
        .modal-close-btn { font-size: 25px; top: 10px; right: 15px; }
        #authSection .auth-container { padding: 20px; } /* Less padding for auth form on very small screens */
        #userLinksSection form { padding: 20px; }
    }
  </style>
</head>
<body>

<header>Free Earnings App</header>

<!-- Auth Section -->
<section id="authSection" class="active">
  <div class="auth-container">
    <h2>Sign Up / Login</h2>
    <input type="text" id="signupName" placeholder="Name" required><br>
    <input type="email" id="signupEmail" placeholder="Email" required><br>
    <input type="password" id="signupPassword" placeholder="Password" required><br>
    <input type="text" id="signupReferralCode" placeholder="Referral Code (Optional)"><br> <!-- Referral code input -->
    <button id="signupBtn" class="submitBtn">Sign Up</button>
    <hr>
    <input type="email" id="loginEmail" placeholder="Email" required><br>
    <input type="password" id="loginPassword" placeholder="Password" required><br>
    <button id="loginBtn" class="submitBtn">Login</button>
  </div>
</section>

<!-- Navigation -->
<nav style="display:none;">
  <button data-section="dashboard">Dashboard</button>
  <button data-section="tasks">Tasks</button>
  <button data-section="referrals">Referral Earnings</button>
  <button data-section="withdrawals">Withdrawal</button>
  <button data-section="deposit">Deposit</button>
  <button data-section="profile">Profile</button>
  <button data-section="youtubeVideo">Watch Video</button>
  <button data-section="userLinksSection">My Links</button> <!-- New button for My Links section -->
  <button id="adminPanelBtn" data-section="adminPanel" style="display:none;">Admin Panel</button>
  <button id="logoutBtn">Logout</button>
</nav>

<!-- Dashboard Section -->
<section id="dashboard">
  <h2>Dashboard</h2>
  <p>Any Problems? Contact the owner via the footer links.</p>
  <div class="dashboard-container">
    <div class="dashboard-box">

      <p>Total Users</p>
      <h3 id="totalUsers">0</h3>
    </div>
    <div class="dashboard-box">
      <p>Active Tasks</p>
      <h3 id="totalTasks">0</h3>
    </div>
    <div class="dashboard-box">
      <p>Total Withdrawals</p>
      <h3 id="totalWithdrawals">0</h3>
    </div>
    <div class="dashboard-box">
      <p>Total Earnings</p>
      <h3 id="totalEarnings">₹0.00</h3>
    </div>
    <div class="dashboard-box">
      <p>Wallet Balance</p>
      <h3>₹<span id="walletBalance">0.00</span></h3>
    </div>
  </div>
<p>
Tasks ko samajhna aapki income barhane ke liye bohot zaroori hai.<br><br>

<strong>1. Tasks ke Types:</strong><br>
<ul>
  <li><strong>Website Visits/Clicks:</strong> Zyada tar tasks me aapko specified website visit karni hoti hai aur kuch actions perform karne hote hain.</li>
  <li><strong>Content Engagement:</strong> Isme short videos dekhna ya posts like karna shamil ho sakta hai.</li>
</ul>

<strong>2. Instructions Dhyan Se Padhen:</strong> Har task ke sath clear instructions hoti hain. Inko accurately follow karna bohot zaroori hai taake aapko payment mile.<br><br>

<strong>3. Verification Process:</strong> Hamara system aapke actions track karta hai taake task completion verify ho sake. Jo tasks incomplete ya fraudulent samjhe jayenge unko credit nahi kiya jayega.
</p>
<p>
Understanding how tasks work is crucial for maximizing your income.<br><br>

<strong>1. Types of Tasks:</strong><br>
<ul>
  <li><strong>Website Visits/Clicks:</strong> Most tasks involve visiting a specified website and performing certain actions.</li>
  <li><strong>Content Engagement:</strong> This could include watching short videos or liking posts.</li>
</ul>

<strong>2. READ INSTRUCTIONS CAREFULLY:</strong> Each task comes with a clear set of instructions. It is absolutely essential to read and follow these instructions precisely to get paid.<br><br>

<strong>3. Verification Process:</strong> Our system tracks your actions to verify task completion. Tasks that are deemed incomplete or fraudulent will not be credited.
</p>
</section>

<!-- Tasks Section -->
<section id="tasks">
  <h2>Tasks to Complete</h2>
  <p>Complete tasks to earn rewards. Cooldown: 5 minutes between completions.</p>
  <div id="tasksContainer"></div>
</section>

<!-- Referrals Section -->
<section id="referrals">
  <h2>Referral Earnings</h2>
  <p>Share your referral link to earn rewards when new users join through your link!</p>
  <input type="text" id="refLink" readonly style="cursor: copy; background: #2a2a2a;">
  <h3>Referred Users:</h3>
  <div id="refUsers"></div>
</section>

<!-- User Added Links Section -->
<section id="userLinksSection">
  <h2>My Added Links</h2>
<p> App 1 Free Add karwa Sakte Hain</p>
<p> 1 day k ley </p>
<p>only website link</p>
<p><b>Payment Account Name: Mujtbha Hassan</b></p>
<p>Easypaisa Number: <b>03425640880</b></p>
<p>1. 1st payment karein (per link charges: 200 PKR).</p>
<p>2. Payment ka screenshot <b>mn1691316@gmail.com</b> par email karein.</p>
<p>3. Transaction ID send karein.</p>
<p>4. Apna naam bhejein.</p>
<p>5. Apna WhatsApp number bhejein.</p>
<p>6. Jo link add karwana chahte hain wo bhi <b>mn1691316@gmail.com</b> par email karein.</p>
<p>7. Aap maximum 10 links add karwa sakte hain.</p>
<p>8. Aur baki sab kuch bhi <b>mn1691316@gmail.com</b> par email karein.</p>
<p>8. Aur baki sab kuch bhi (agar koi additional information ya details hain) <b>mn1691316@gmail.com</b> par email karna hai.</p>
  <p>Add your own links here and earn rewards when others visit them. Each link costs ₹200 from your wallet and has a limit of 10 links per user. This Is Working </p>
  
  <form id="addUserLinkForm"> <!-- NOTE: changed id to addUserLinkForm -->
    <label for="userLinkUrl">Link URL:</label>
    <input type="url" id="userLinkUrl" placeholder="Enter URL (e.g., https://yourwebsite.com)" required><br>
    
    <label for="userLinkDescription">Link Description:</label>
    <input type="text" id="userLinkDescription" placeholder="Brief description for your link" required><br>

    <button type="submit" class="submitBtn">Add Link (Cost: ₹200)</button>
  </form>
  
  <h3>Your Added Links:</h3>
  <div id="userLinksContainer" class="dashboard-container"></div>
</section>

<!-- Withdrawals Section -->
<section id="withdrawals">
  <h2>Request Withdrawal</h2>
  <div style="background: #1a1a1a; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #333;">
    <p style="color: #ffc107;"><strong>Important Withdrawal Information:</strong></p>
    <ul>
        <li>Payment dates are 19-22 and 28-31 of each month.</li>
        <li>If these dates fall on weekends or holidays, payments will be processed on the nearest business day.</li>
        <li>A two-week hold period applies after reaching the minimum payout amount.</li>
        <li>Minimum withdrawal: ₹1200 for Easypaisa/JazzCash/Bank, 12 USDT for Bitget.</li>
        <li>All withdrawal requests are manually reviewed.</li>
    </ul>
  </div>
  <form id="withdrawForm">
    <label for="withdrawMethod">Select Method:</label>
    <select id="withdrawMethod" required>
      <option value="Easypaisa">Easypaisa (03435640880 - Mujtaba Hassan)</option>
      <option value="JazzCash">JazzCash</option>
      <option value="Bank">Allied Bank</option>
      <option value="Bitget">Bitget USDT (Min 12 USDT)</option>
    </select><br>
    <input type="text" id="withdrawAccount" placeholder="Enter Your Account/Wallet Details" required><br>
    <input type="number" id="withdrawAmount" placeholder="Enter Amount (Min ₹1200)" required><br>
    <button type="submit" class="submitBtn">Request Withdrawal</button>
  </form>
  <h3>Your Withdrawal History:</h3>
  <div id="withdrawList"></div>
</section>

<!-- Deposit Section -->
<section id="deposit">
  <h2>Deposit Funds</h2>
  <p>Apne account mein funds add karne ke liye, neeche di gai hidayat follow karen:</p>
  <div class="deposit-info-box">
    <p><strong>Payment Details:</strong></p>
    <ul>
      <li><strong>Method:</strong> Easypaisa</li>
      <li><strong>Account Number:</strong> 03435640880</li>
      <li><strong>Account Name:</strong> Mujtaba Hassan</li>
    </ul>
    <p><strong>Instructions:</strong></p>
    <ul>
      <li>Apnay Easypaisa account se oper diye gaye number par raqam send karen.</li>
      <li>Raqam send karne ke baad, transaction ID ko copy karen.</li>
      <li>Neeche diye gaye form mein transaction ID aur amount enter karen aur Submit karen.</li>
      <li>Admin apki payment verify karega aur kuch dair mein aapka balance update ho jayega.</li>
    </ul>
  </div>
  <form id="depositForm">
    <input type="text" id="transactionId" placeholder="Enter Transaction ID" required><br>
    <input type="number" id="depositAmount" placeholder="Enter Amount to Deposit" required><br>
    <button type="submit" class="submitBtn">Submit Deposit Request</button>
  </form>
  <h3>Your Deposit History:</h3>
  <div id="depositList"></div>
</section>

<!-- Profile Section -->
<section id="profile">
  <h2>My Profile</h2>
  <div class="profile-card">
    <div class="profile-header">
      <div id="userProfilePic" class="profile-pic"></div>
      <div class="profile-info">
        <h2 id="userName"></h2>
        <p id="userEmail"></p>
        <p>Referral Code: <span id="userRef" class="referral-code"></span></p>
      </div>
    </div>
    <div class="profile-stats">
      <div class="stat-item">
        <p>Account Balance</p>
        <h3>₹<span id="walletBalanceProfile">0.00</span></h3>
      </div>
      <div class="stat-item">
        <p>Total Referrals</p>
        <h3 id="totalReferralsCount">0</h3>
      </div>
    </div>
    <div class="profile-actions">
      <button id="editProfileBtn">Edit Profile</button>
    </div>
  </div>
</section>

<!-- Admin Panel Section -->
<section id="adminPanel">
    <h2>Admin Panel</h2>
    <form id="adminAddForm">
        <label for="adminItemType">Item Type:</label>
        <select id="adminItemType" required>
            <option value="task">Task</option>
            <option value="link">Link</option>
        </select><br>

        <label for="adminDescription">Description:</label>
        <input type="text" id="adminDescription" placeholder="e.g., Visit this website for 30 seconds" required><br>
        
        <label for="adminBaseUrl">Main URL (for Tasks):</label>
        <input type="text" id="adminBaseUrl" placeholder="e.g., https://example.com"><br>

        <div id="dynamicLinkInputs">
            <p>Additional Links (optional, up to 4):</p>
            <div class="dynamic-link-input">
                <input type="text" name="links[]" placeholder="Link 1 URL">
            </div>
            <div class="dynamic-link-input">
                <input type="text" name="links[]" placeholder="Link 2 URL">
            </div>
             <div class="dynamic-link-input">
                <input type="text" name="links[]" placeholder="Link 3 URL">
            </div>
             <div class="dynamic-link-input">
                <input type="text" name="links[]" placeholder="Link 4 URL">
            </div>
        </div>
        
        <label for="adminReward">Reward Amount (₹):</label>
        <input type="number" id="adminReward" placeholder="e.g., 0.025" step="0.01" required><br>

        <button type="submit" class="submitBtn">Add Earning Item</button>
    </form>
    
    <div style="margin-top: 40px;">
        <h3>Current Tasks:</h3>
        <div id="adminTasksContainer" class="dashboard-container"></div>
        <h3>Current Links:</h3>
        <div id="adminLinksContainer" class="dashboard-container"></div>
    </div>
</section>

<!-- YouTube Video Section -->
             <p> watch Video full earn 0.005$ </p> 
<section id="youtubeVideoSection">
  <h2>Watch Our Latest Video</h2>
  <div id="videoPlayerContainer">
    <iframe id="youtubeVideoPlayer" width="560" height="315" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
  </div>
  <p>Stay updated with our latest tutorials and earning tips!</p>
</section>

<!-- Modal for Details -->
<div id="detailsModal" class="modal">
  <div class="modal-content">
    <span class="modal-close-btn">&times;</span>
    <h2 id="modalTitle"></h2>
    <div id="modalText"></div>
  </div>
</div>

<!-- Footer -->
<footer>
  <div class="footer-links">
    <a id="privacyBtn">Privacy Policy</a>
    <a id="termsBtn">Terms of Service</a>
    <a id="aboutBtn">About Us</a>
    <a id="taskDetailsBtn">Task Details</a>
    <a id="withdrawalProfileBtn">Withdrawal Profile</a>
    <a id="contactEmailLink">Contact via Email</a>
    <a id="contactWhatsappLink">Contact via WhatsApp</a>
  </div>
  <p class="copyright">&copy; 2025 Free Earnings App. All Rights Reserved.</p>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, doc, onSnapshot, setDoc, addDoc, getDoc, getCountFromServer, Timestamp, query, where, deleteDoc, writeBatch, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

// Firebase Configuration - REPLACE WITH YOUR ACTUAL CONFIG
const firebaseConfig = {
    apiKey: "AIzaSyDNYv9SNUjMAHlaPzfovyYefoBNDgx4Gd4", // YOUR API KEY
    authDomain: "traffic-exchange-62a58.firebaseapp.com", // YOUR AUTH DOMAIN
    projectId: "traffic-exchange-62a58", // YOUR PROJECT ID
    storageBucket: "traffic-exchange-62a58.appspot.com", // YOUR STORAGE BUCKET
    messagingSenderId: "474999317287", // YOUR MESSAGING SENDER ID
    appId: "1:474999317287:web:8e28a2f5f1a959d8ce3f02", // YOUR APP ID
    measurementId: "G-HJQ46RQNZS" // YOUR MEASUREMENT ID
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth();

// --- Global Constants and Configuration ---
const adminEmail = "mn1691316@gmail.com"; // Your admin email
const whatsappNumber = "+923495144924";   // Your WhatsApp number (with country code)
const MIN_WITHDRAWAL_AMOUNT = 1200;
const TASK_EARNING_AMOUNT = 0.025; // Default earning for tasks/links if admin doesn't set
const TASK_LINK_COOLDOWN_MS = 0 * 60 * 1000; // 5 minutes
const LINK_COST = 200; // Cost for adding a user-generated link
const MAX_USER_LINKS = 10; // Max links a user can add

// --- DOM Elements ---
const nav = document.querySelector("nav");
const adminPanelBtn = document.getElementById("adminPanelBtn");
const adminPanelSection = document.getElementById("adminPanel");
const authSection = document.getElementById("authSection");
const signupNameInput = document.getElementById("signupName");
const signupEmailInput = document.getElementById("signupEmail");
const signupPasswordInput = document.getElementById("signupPassword");
const signupReferralCodeInput = document.getElementById("signupReferralCode"); // Added referral input
const signupBtn = document.getElementById("signupBtn");
const loginEmailInput = document.getElementById("loginEmail");
const loginPasswordInput = document.getElementById("loginPassword");
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const refLinkInput = document.getElementById("refLink");
const depositForm = document.getElementById("depositForm");
const transactionIdInput = document.getElementById("transactionId");
const depositAmountInput = document.getElementById("depositAmount");
const depositListContainer = document.getElementById("depositList");
const adminAddForm = document.getElementById("adminAddForm");
const adminItemTypeSelect = document.getElementById("adminItemType");
const adminDescriptionInput = document.getElementById("adminDescription");
const adminBaseUrlInput = document.getElementById("adminBaseUrl");
const adminRewardInput = document.getElementById("adminReward");
const adminTasksContainer = document.getElementById("adminTasksContainer");
const adminLinksContainer = document.getElementById("adminLinksContainer");
const modal = document.getElementById("detailsModal");
const modalTitle = document.getElementById("modalTitle");
const modalText = document.getElementById("modalText");
const closeBtn = modal.querySelector(".modal-close-btn");
const privacyBtn = document.getElementById("privacyBtn");
const termsBtn = document.getElementById("termsBtn");
const aboutBtn = document.getElementById("aboutBtn");
const taskDetailsBtn = document.getElementById("taskDetailsBtn");
const withdrawalProfileBtn = document.getElementById("withdrawalProfileBtn");
const contactEmailLink = document.getElementById("contactEmailLink");
const contactWhatsappLink = document.getElementById("contactWhatsappLink");
const userProfilePic = document.getElementById("userProfilePic");
const userNameDisplay = document.getElementById("userName");
const userEmailDisplay = document.getElementById("userEmail");
const userRefDisplay = document.getElementById("userRef");
const walletBalanceDisplay = document.getElementById("walletBalance");
const walletBalanceProfileDisplay = document.getElementById("walletBalanceProfile");
const totalReferralsCountDisplay = document.getElementById("totalReferralsCount");
const totalUsersDisplay = document.getElementById("totalUsers");
const totalTasksDisplay = document.getElementById("totalTasks");
const totalWithdrawalsDisplay = document.getElementById("totalWithdrawals");
const totalEarningsDisplay = document.getElementById("totalEarnings");
const dynamicLinkInputsContainer = document.getElementById("dynamicLinkInputs");
// User Added Links elements
const addUserLinkForm = document.getElementById("addUserLinkForm"); // Corrected ID
const userLinkUrlInput = document.getElementById("userLinkUrl");
const userLinkDescriptionInput = document.getElementById("userLinkDescription");
const userLinksContainer = document.getElementById("userLinksContainer");

// --- Helper Functions ---

// YouTube Video Embed Logic
function updateYouTubeVideo(videoUrl) {
  const iframe = document.getElementById("youtubeVideoPlayer");
  const videoSection = document.getElementById("youtubeVideoSection");
  if (!iframe || !videoSection) return;

  if (videoUrl) {
    let videoId = '';
    if (videoUrl.includes("youtu.be/")) videoId = videoUrl.split("youtu.be/")[1].split("?")[0];
    else if (videoUrl.includes("youtube.com/watch?v=")) videoId = videoUrl.split("v=")[1].split("&")[0];
    else if (videoUrl.includes("youtube.com/embed/")) videoId = videoUrl.split("/embed/")[1].split("?")[0];

    if (videoId) {
      iframe.src = `https://www.youtube.com/embed/${videoId}`;
      videoSection.style.display = "block";
    } else {
      console.error("Invalid YouTube URL provided:", videoUrl);
      iframe.src = ""; videoSection.style.display = "none";
    }
  } else {
    iframe.src = ""; videoSection.style.display = "none";
  }
}

// Button State Management for Cooldowns
function updateButtonState(button, itemId, itemType) {
  const lastOpenedKey = `${itemType}_${itemId}`;
  const lastOpenedTimestamp = localStorage.getItem(lastOpenedKey);
  
  if (button.dataset.intervalId) { 
    clearInterval(parseInt(button.dataset.intervalId));
    button.dataset.intervalId = '';
  }

  if (!lastOpenedTimestamp) {
    button.disabled = false;
    button.innerText = `Open & Earn ₹${TASK_EARNING_AMOUNT.toFixed(2)}`;
    return;
  }

  const lastOpened = parseInt(lastOpenedTimestamp);
  const timeElapsed = new Date().getTime() - lastOpened;

  if (timeElapsed < TASK_LINK_COOLDOWN_MS) {
    button.disabled = true;
    const countdownInterval = setInterval(() => {
      const newTimeElapsed = new Date().getTime() - lastOpened;
      if (newTimeElapsed >= TASK_LINK_COOLDOWN_MS) {
        clearInterval(countdownInterval);
        button.disabled = false;
        button.innerText = `Open & Earn ₹${TASK_EARNING_AMOUNT.toFixed(2)}`;
        localStorage.removeItem(lastOpenedKey);
        button.dataset.intervalId = '';
      } else {
        const timeLeftMs = TASK_LINK_COOLDOWN_MS - newTimeElapsed;
        const minutes = Math.floor(timeLeftMs / 60000);
        const seconds = Math.floor((timeLeftMs % 60000) / 1000).toString().padStart(2, '0');
        button.innerText = `Wait ${minutes}:${seconds}`;
      }
    }, 1000);
    button.dataset.intervalId = countdownInterval;
  } else {
    button.disabled = false;
    button.innerText = `Open & Earn ₹${TASK_EARNING_AMOUNT.toFixed(2)}`;
    localStorage.removeItem(lastOpenedKey);
  }
}

// Clear all countdown intervals
function clearAllCountdowns() {
    document.querySelectorAll('button[data-interval-id]').forEach(btn => {
        if (btn.dataset.intervalId) {
            clearInterval(parseInt(btn.dataset.intervalId));
            btn.dataset.intervalId = '';
        }
    });
}

// Show specific section, hide others
function showSection(id) {
  document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
  const sectionToShow = document.getElementById(id);
  if (sectionToShow) sectionToShow.classList.add('active');
}

// Show a toast notification
function showToast(message) {
    alert(message);
}

// Robust link opening with fallback
function openLinkSafely(url) {
    if (!url || typeof url !== 'string' || !url.startsWith('http')) {
        showToast("Invalid URL provided.");
        return false;
    }

    try {
        const newWindow = window.open(url, '_blank');
        if (newWindow) {
            newWindow.focus();
            return true;
        } else {
            showToast("Pop-up blocked. Please allow pop-ups for this site or click the link directly.");
            createAndClickAnchor(url);
            return false;
        }
    } catch (e) {
        console.error("Error using window.open:", e);
        showToast("Could not open link directly. Trying an alternative method.");
        createAndClickAnchor(url);
        return false;
    }
}

// Fallback to create and click an anchor element
function createAndClickAnchor(url) {
    const link = document.createElement('a');
    link.href = url;
    link.target = '_blank';
    link.style.display = 'none';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// Function to generate a referral code
function generateReferralCode(uid) {
    const prefix = uid.substring(0, 4).toUpperCase();
    const suffix = Math.random().toString(36).substring(2, 6).toUpperCase();
    return `${prefix}-${suffix}`;
}

// --- Authentication and UI State Management ---
onAuthStateChanged(auth, async user => {
  clearAllCountdowns(); 

  if (user) {
    authSection.style.display = "none";
    nav.style.display = "flex";
    showSection('dashboard'); 

    if (user.email === adminEmail) {
      adminPanelBtn.style.display = "block";
      loadAdminDataIfAdmin(user); 
    } else {
      adminPanelBtn.style.display = "none";
      if (adminPanelSection.classList.contains('active')) {
          showSection('dashboard');
      }
    }
    loadUserData(user);
    loadUserDepositHistory(user.uid);
    loadUserAddedLinks(user.uid); // Load user's added links
    
    const userRef = doc(db, "users", user.uid);
    const withdrawalsCol = collection(db, "withdrawals");
    onSnapshot(query(withdrawalsCol, where("userId", "==", user.uid), orderBy("timestamp", "desc")), snap => {
        const container = document.getElementById("withdrawList");
        container.innerHTML = "";
        snap.forEach(doc => {
            const w = doc.data();
            const withdrawDiv = document.createElement("div");
            withdrawDiv.classList.add("withdrawBox");
            const statusClass = 'status-' + w.status.toLowerCase().replace(/\s+/g, '-');
            
            let requestDate = 'N/A';
            if (w.timestamp && typeof w.timestamp.toDate === 'function') {
                requestDate = w.timestamp.toDate().toLocaleString();
            } else if (w.timestamp) {
                requestDate = new Date(w.timestamp).toLocaleString();
            }

            withdrawDiv.innerHTML = `
                <p><strong>Method:</strong> ${w.method}</p>
                <p><strong>Account:</strong> ${w.accountNumber}</p>
                <p><strong>Amount:</strong> ₹${w.amount.toFixed(2)}</p>
                <p><strong>Status:</strong> <span class="${statusClass}">${w.status}</span></p>
                <p><small>Requested: ${requestDate}</small></p>
            `;
            container.appendChild(withdrawDiv);
        });
    });

  } else {
    authSection.style.display = "block";
    nav.style.display = "none";
    showSection('authSection');
    adminPanelBtn.style.display = "none";
    
    userNameDisplay.innerText = ""; userEmailDisplay.innerText = ""; userRefDisplay.innerText = "";
    walletBalanceDisplay.innerText = "0.00"; walletBalanceProfileDisplay.innerText = "0.00";
    totalReferralsCountDisplay.innerText = "0"; refLinkInput.value = "";
    userProfilePic.innerText = "?"; userProfilePic.style.backgroundImage = 'none'; userProfilePic.style.backgroundColor = '#333';
    totalUsersDisplay.innerText = "0"; totalTasksDisplay.innerText = "0";
    totalWithdrawalsDisplay.innerText = "0"; totalEarningsDisplay.innerText = "₹0.00";
    document.getElementById("withdrawList").innerHTML = "";
    depositListContainer.innerHTML = "";
    userLinksContainer.innerHTML = ""; // Clear user added links
  }
});

// --- Event Listeners for Authentication ---
signupBtn.addEventListener("click", async () => {
    const name = signupNameInput.value.trim();
    const email = signupEmailInput.value.trim();
    const password = signupPasswordInput.value.trim();
    const referralCode = signupReferralCodeInput.value.trim(); // Get referral code

    if (!name || !email || !password) { showToast("Please fill in all fields."); return; }

    try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        await updateProfile(user, { displayName: name });

        let referrerDoc = null;
        let referredByUserId = null;

        if (referralCode) {
            const usersCol = collection(db, "users");
            const q = query(usersCol, where("referralCode", "==", referralCode));
            const querySnapshot = await getDocs(q);

            if (!querySnapshot.empty) {
                referrerDoc = querySnapshot.docs[0]; 
                referredByUserId = referrerDoc.id;
                showToast(`Welcome! You were referred by ${referrerDoc.data().name}.`);
            } else {
                showToast("Referral code not found. You will not be credited for a referral.");
            }
        }
        
        const newUserRefCode = generateReferralCode(user.uid);
        
        const newUserDocData = {
            name: name, 
            email: email, 
            wallet: 0, 
            referralCode: newUserRefCode, 
            referredBy: referredByUserId, 
            createdAt: Timestamp.now(),
            referralCount: 0, // Initialize referral count
            userLinkCount: 0 // Initialize user link count
        };

        await setDoc(doc(db, "users", user.uid), newUserDocData);

        if (referrerDoc) {
            const batch = writeBatch(db);
            const referrerRef = doc(db, "users", referrerDoc.id);
            const currentReferralCount = referrerDoc.data().referralCount || 0;
            batch.update(referrerRef, { referralCount: currentReferralCount + 1 });
            await batch.commit();
        }

        showToast("Sign up successful! Please log in.");
        signupNameInput.value = ''; signupEmailInput.value = ''; signupPasswordInput.value = '';
        signupReferralCodeInput.value = ''; 

    } catch (error) {
        console.error("Sign up error:", error);
        showToast(`Sign up failed: ${error.message}`);
    }
});

loginBtn.addEventListener("click", async () => {
    const email = loginEmailInput.value.trim();
    const password = loginPasswordInput.value.trim();

    if (!email || !password) { showToast("Please enter your email and password."); return; }

    try {
        await signInWithEmailAndPassword(auth, email, password);
        showToast("Login successful!");
    } catch (error) {
        console.error("Login error:", error); showToast(`Login failed: ${error.message}`);
    }
});

logoutBtn.addEventListener("click", async () => {
    try {
        await signOut(auth);
        showToast("Logged out successfully.");
    } catch (error) {
        console.error("Logout error:", error); showToast(`Logout failed: ${error.message}`);
    }
});

// --- User Data Loading and Real-time Updates ---
function loadUserData(user) {
    const usersCol = collection(db, "users");
    const userRef = doc(db, "users", user.uid);
    const tasksCol = collection(db, "tasks");
    const settingsCol = collection(db, "settings");

    const youtubeSettingsRef = doc(settingsCol, "youtubeSettings");
    getDoc(youtubeSettingsRef).then(docSnap => {
        if (docSnap.exists() && docSnap.data().videoUrl) updateYouTubeVideo(docSnap.data().videoUrl);
    }).catch(error => { console.error("Error fetching YouTube settings:", error); updateYouTubeVideo(null); });

    onSnapshot(userRef, async snap => {
        if (snap.exists()) {
            const data = snap.data();
            userNameDisplay.innerText = data.name || user.displayName || "N/A";
            userEmailDisplay.innerText = data.email || user.email;
            
            const referralCode = data.referralCode || generateReferralCode(user.uid); 
            userRefDisplay.innerText = referralCode;
            refLinkInput.value = `${window.location.origin}${window.location.pathname}?ref=${referralCode}`;
            
            walletBalanceDisplay.innerText = (data.wallet || 0).toFixed(2);
            walletBalanceProfileDisplay.innerText = (data.wallet || 0).toFixed(2);

            if (data.profilePicUrl) {
                userProfilePic.innerHTML = '';
                userProfilePic.style.backgroundImage = `url(${data.profilePicUrl})`;
                userProfilePic.style.backgroundSize = 'cover'; userProfilePic.style.backgroundPosition = 'center';
                userProfilePic.style.color = 'transparent'; 
            } else if (data.name) {
                const initials = data.name.trim().split(' ').map(word => word[0]).join('').toUpperCase();
                userProfilePic.innerText = initials;
                userProfilePic.style.backgroundImage = 'none';
                const colors = ['#1abc9c', '#3498db', '#9b59b6', '#f1c40f', '#e67e22', '#e74c3c'];
                userProfilePic.style.backgroundColor = colors[initials.charCodeAt(0) % colors.length];
            } else {
                userProfilePic.innerText = '?'; userProfilePic.style.backgroundColor = '#333';
                userProfilePic.style.backgroundImage = 'none';
            }

            const referralQuery = query(usersCol, where("referredBy", "==", user.uid));
            getCountFromServer(referralQuery).then(querySnapshot => {
                totalReferralsCountDisplay.innerText = querySnapshot.data().count;
            }).catch(error => console.error("Error getting referral count: ", error));
        } else {
            const referralCode = generateReferralCode(user.uid);
            await setDoc(userRef, {
                name: user.displayName || "New User", email: user.email, wallet: 0, referralCode: referralCode, referredBy: null, createdAt: Timestamp.now(), referralCount: 0, userLinkCount: 0
            });
            showToast("Your profile data was initialized.");
            loadUserData(user); 
        }
    });

    onSnapshot(tasksCol, snap => {
        const container = document.getElementById("tasksContainer");
        container.innerHTML = ""; 
        
        snap.forEach(doc => {
            const t = doc.data();
            const taskId = doc.id;
            const taskDiv = document.createElement("div");
            taskDiv.classList.add("taskBox");
            const reward = t.reward || TASK_EARNING_AMOUNT;
            taskDiv.innerHTML = `<p>${t.description}</p><button class="submitBtn">Open & Earn ₹${reward.toFixed(2)}</button>`;
            const button = taskDiv.querySelector("button");
            updateButtonState(button, taskId, 'task');

            button.addEventListener("click", async () => {
                const lastOpenedKey = `task_${taskId}`;
                const lastOpenedTimestamp = localStorage.getItem(lastOpenedKey);
                const lastOpened = lastOpenedTimestamp ? parseInt(lastOpenedTimestamp) : 0;
                const timeElapsed = new Date().getTime() - lastOpened;

                if (timeElapsed < TASK_LINK_COOLDOWN_MS) {
                    showToast("Please wait for the cooldown period to finish.");
                    return;
                }

                const opened = openLinkSafely(t.url);
                
                if (opened) {
                    localStorage.setItem(lastOpenedKey, new Date().getTime().toString());
                    updateButtonState(button, taskId, 'task');

                    const userSnap = await getDoc(userRef);
                    await setDoc(userRef, { wallet: (userSnap.data().wallet || 0) + reward }, { merge: true });
                    showToast(`You earned ₹${reward.toFixed(2)}! Wallet updated.`);
                }
            });
            container.appendChild(taskDiv);
        });
    });

    // Dashboard Stats (Totals)
    onSnapshot(usersCol, snap => { totalUsersDisplay.innerText = snap.size; });
    onSnapshot(tasksCol, snap => { totalTasksDisplay.innerText = snap.size; });
    onSnapshot(collection(db, "withdrawals"), snap => {
        totalWithdrawalsDisplay.innerText = snap.size;
        let totalApprovedWithdrawals = 0;
        snap.forEach(doc => {
            if (doc.data().status === "Approved") {
                totalApprovedWithdrawals += parseFloat(doc.data().amount || 0);
            }
        });
        totalEarningsDisplay.innerText = "₹" + totalApprovedWithdrawals.toFixed(2);
    });
}

// --- Deposit History Loading ---
function loadUserDepositHistory(userId) {
    const depositsCol = collection(db, "deposits");
    onSnapshot(query(depositsCol, where("userId", "==", userId), orderBy("timestamp", "desc")), snap => {
        depositListContainer.innerHTML = "";
        snap.forEach(doc => {
            const d = doc.data();
            const depositDiv = document.createElement("div");
            depositDiv.classList.add("withdrawBox"); 
            const statusClass = 'status-' + d.status.toLowerCase().replace(/\s+/g, '-');
            
            let requestDate = 'N/A';
            if (d.timestamp && typeof d.timestamp.toDate === 'function') {
                requestDate = d.timestamp.toDate().toLocaleString();
            } else if (d.timestamp) {
                requestDate = new Date(d.timestamp).toLocaleString();
            }

            depositDiv.innerHTML = `
                <p><strong>Tx ID:</strong> ${d.transactionId}</p>
                <p><strong>Amount:</strong> ₹${d.amount.toFixed(2)}</p>
                <p><strong>Status:</strong> <span class="${statusClass}">${d.status}</span></p>
                <p><small>Submitted: ${requestDate}</small></p>
            `;
            depositListContainer.appendChild(depositDiv);
        });
    });
}

// --- User Added Links Functions ---
function loadUserAddedLinks(userId) {
    const userAddedLinksCol = collection(db, "userAddedLinks");
    const q = query(userAddedLinksCol, where("addedByUserId", "==", userId), orderBy("addedAt", "desc"));

    onSnapshot(q, snap => {
        userLinksContainer.innerHTML = ""; // Clear existing links
        if (snap.empty) {
            userLinksContainer.innerHTML = "<p>You haven't added any links yet.</p>";
            return;
        }
        snap.forEach(doc => {
            const linkData = doc.data();
            const linkId = doc.id;
            const linkDiv = document.createElement("div");
            linkDiv.classList.add("userLinkBox");
            linkDiv.innerHTML = `
                <p><strong>${linkData.description}</strong></p>
                <p><a href="${linkData.url}" target="_blank" style="color: #0ff; text-decoration: none;">${linkData.url}</a></p>
                <small>Added: ${linkData.addedAt ? linkData.addedAt.toDate().toLocaleDateString() : 'N/A'}</small><br>
                <div class="edit-delete-buttons">
                    <button class="edit-btn">Edit</button>
                    <button class="delete-btn">Delete</button>
                </div>
            `;
            // Add event listeners for edit and delete
            linkDiv.querySelector('.edit-btn').addEventListener('click', () => editUserLink(linkId, linkData));
            linkDiv.querySelector('.delete-btn').addEventListener('click', () => deleteUserLink(linkId));
            userLinksContainer.appendChild(linkDiv);
        });
    });
}

async function editUserLink(linkId, currentData) {
    const newUrl = prompt("Edit Link URL:", currentData.url);
    if (newUrl === null) return; // User cancelled
    const newDescription = prompt("Edit Link Description:", currentData.description);
    if (newDescription === null) return; // User cancelled

    if (!newUrl.trim() || !newDescription.trim()) {
        showToast("URL and description cannot be empty.");
        return;
    }

    if (!newUrl.startsWith('http')) {
        showToast("Please enter a valid URL starting with http or https.");
        return;
    }

    try {
        await setDoc(doc(db, "userAddedLinks", linkId), {
            ...currentData, 
            url: newUrl.trim(),
            description: newDescription.trim(),
            updatedAt: Timestamp.now()
        }, { merge: true });
        showToast("Link updated successfully!");
    } catch (error) {
        console.error("Error updating link:", error);
        showToast("Failed to update link. Please try again.");
    }
}

async function deleteUserLink(linkId) {
    if (!confirm("Are you sure you want to delete this link? This action cannot be undone.")) {
        return;
    }

    try {
        await deleteDoc(doc(db, "userAddedLinks", linkId));
        showToast("Link deleted successfully!");
    } catch (error) {
        console.error("Error deleting link:", error);
        showToast("Failed to delete link. Please try again.");
    }
}

// --- Event Listeners for Forms and Buttons ---

// Add User Link Form Submission
addUserLinkForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const user = auth.currentUser;
    if (!user) { showToast("Please log in to add links."); return; }

    const url = userLinkUrlInput.value.trim();
    const description = userLinkDescriptionInput.value.trim();

    if (!url || !description) {
        showToast("Please enter both URL and description.");
        return;
    }
    if (!url.startsWith('http')) {
        showToast("Please enter a valid URL starting with http or https.");
        return;
    }

    // Check current user's added links count
    const userRef = doc(db, "users", user.uid);
    const userDocSnap = await getDoc(userRef);
    const userData = userDocSnap.data();
    
    const currentUserLinkCount = userData.userLinkCount || 0; 

    if (currentUserLinkCount >= MAX_USER_LINKS) {
        showToast(`You have reached the maximum limit of ${MAX_USER_LINKS} added links.`);
        return;
    }

    // Check wallet balance
    if ((userData.wallet || 0) < LINK_COST) {
        showToast(`Insufficient balance. You need at least ₹${LINK_COST} to add a link.`);
        return;
    }

    // Proceed with adding the link and deducting cost
    try {
        const batch = writeBatch(db);

        // 1. Deduct cost from wallet
        batch.update(userRef, { wallet: (userData.wallet || 0) - LINK_COST });

        // 2. Increment userLinkCount
        batch.update(userRef, { userLinkCount: currentUserLinkCount + 1 });

        // 3. Add the new link to userAddedLinks collection
        const userAddedLinksCol = collection(db, "userAddedLinks");
        const newLinkRef = doc(userAddedLinksCol); // Auto-generated ID
        batch.set(newLinkRef, {
            addedByUserId: user.uid,
            url: url,
            description: description,
            addedAt: Timestamp.now(),
            status: "Active" // Assuming links are active by default
        });

        await batch.commit();
        showToast(`Link added successfully! ₹${LINK_COST} deducted from your wallet.`);
        addUserLinkForm.reset(); 
    } catch (error) {
        console.error("Error adding user link:", error);
        showToast("Failed to add link. Please try again.");
    }
});

// Withdrawal Form Submission
document.getElementById("withdrawForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const user = auth.currentUser;
    if (!user) { showToast("Please log in to request withdrawal."); return; }

    const method = document.getElementById("withdrawMethod").value;
    const accountNumber = document.getElementById("withdrawAccount").value.trim();
    const amount = parseFloat(document.getElementById("withdrawAmount").value);

    if (amount < MIN_WITHDRAWAL_AMOUNT) {
        showToast(`Minimum withdrawal amount is ₹${MIN_WITHDRAWAL_AMOUNT}.`);
        return;
    }
    if (!accountNumber) {
        showToast("Please enter your account details.");
        return;
    }

    try {
        await addDoc(collection(db, "withdrawals"), {
            userId: user.uid, method: method, accountNumber: accountNumber, amount: amount, status: "Pending", timestamp: Timestamp.now()
        });
        showToast("Withdrawal request submitted successfully. It will be processed soon.");
        e.target.reset();
    } catch (error) {
        console.error("Error submitting withdrawal request:", error); showToast("Failed to submit withdrawal request. Please try again.");
    }
});

// Deposit Form Submission Handler
depositForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const user = auth.currentUser;

    if (!user) { showToast("Please log in to deposit funds."); return; }
    
    const txId = transactionIdInput.value.trim();
    const amount = parseFloat(depositAmountInput.value);

    if (!txId || isNaN(amount) || amount <= 0) {
        showToast("Please enter a valid transaction ID and deposit amount.");
        return;
    }

    const userRef = doc(db, "users", user.uid);
    const depositsCol = collection(db, "deposits");

    try {
        await addDoc(depositsCol, {
            userId: user.uid, userName: user.displayName || user.email, transactionId: txId, amount: amount, status: "Pending Verification", timestamp: Timestamp.now()
        });

        showToast("Deposit request submitted successfully. Please wait for verification.");
        depositForm.reset();
    } catch (error) {
        console.error("Error submitting deposit request:", error); showToast("Failed to submit deposit request. Please try again.");
    }
});

// Admin Panel Form Submission
adminAddForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const itemType = adminItemTypeSelect.value;
    const description = adminDescriptionInput.value.trim();
    const mainUrl = adminBaseUrlInput.value.trim();
    const reward = parseFloat(adminRewardInput.value);
    const linkInputs = adminAddForm.querySelectorAll('.dynamic-link-input input');
    const urls = Array.from(linkInputs).map(input => input.value.trim()).filter(url => url); 

    if (!description || isNaN(reward) || reward <= 0) {
        showToast("Please provide a valid description and reward amount.");
        return;
    }

    let collectionRef;
    let itemData = { description, reward, createdAt: Timestamp.now() };

    if (itemType === "task") {
        if (!mainUrl || !mainUrl.startsWith("http")) {
            showToast("Please enter a valid URL for tasks.");
            return;
        }
        collectionRef = collection(db, "tasks");
        itemData.url = mainUrl;
    } else if (itemType === "link") {
        if (!urls || urls.length === 0) {
            showToast("Please enter at least one URL for links.");
            return;
        }
        collectionRef = collection(db, "links");
        itemData.urls = urls;
    } else {
        showToast("Invalid item type selected.");
        return;
    }

    try {
        await addDoc(collectionRef, itemData);
        showToast(`${itemType.charAt(0).toUpperCase() + itemType.slice(1)} added successfully!`);
        adminAddForm.reset();
        linkInputs.forEach(input => input.value = ''); 
    } catch (error) {
        console.error("Error adding item:", error); showToast(`Failed to add ${itemType}. Please try again.`);
    }
});


// --- Admin Specific Functions ---
function loadAdminDataIfAdmin(user) {
    if (user.email === adminEmail) {
        adminPanelBtn.style.display = "block";
        displayAdminItems(collection(db, "tasks"), adminTasksContainer, "tasks");
        displayAdminItems(collection(db, "links"), adminLinksContainer, "links");
    } else {
        adminPanelBtn.style.display = "none";
    }
}

async function displayAdminItems(collectionRef, container, itemType) {
    container.innerHTML = '';
    const q = query(collectionRef, orderBy("createdAt", "desc"), limit(1000)); 
    const querySnapshot = await getDocs(q);

    querySnapshot.forEach(doc => {
        const item = doc.data();
        const itemDiv = document.createElement("div");
        itemDiv.classList.add(itemType === "tasks" ? "taskBox" : "linkBox"); 
        itemDiv.style.maxWidth = "300px"; itemDiv.style.flexGrow = "0"; 

        let displayContent = `
            <p><strong>${item.description}</strong></p>
            <p>Reward: ₹${(item.reward || TASK_EARNING_AMOUNT).toFixed(2)}</p>
            <small>Created: ${item.createdAt ? item.createdAt.toDate().toLocaleDateString() : 'N/A'}</small><br>
        `;

        if (itemType === "tasks") {
            displayContent += `<p>URL: <a href="${item.url}" target="_blank" style="color: #0ff; text-decoration: none;">${item.url}</a></p>`;
        } else if (itemType === "links" && item.urls && Array.isArray(item.urls)) {
            displayContent += `<p>Links:</p><ul>`;
            item.urls.forEach((url, index) => {
                displayContent += `<li><a href="${url}" target="_blank" style="color: #0ff; text-decoration: none;">Link ${index + 1}</a></li>`;
            });
            displayContent += `</ul>`;
        }
        itemDiv.innerHTML = displayContent;

        const deleteButton = document.createElement("button");
        deleteButton.textContent = "Delete";
        deleteButton.style.background = "#dc3545"; deleteButton.style.color = "white"; deleteButton.style.border = "none";
        deleteButton.style.padding = "8px 15px"; deleteButton.style.borderRadius = "6px";
        deleteButton.style.cursor = "pointer"; deleteButton.style.marginTop = "10px";
        deleteButton.onclick = async () => {
            if (confirm(`Are you sure you want to delete this ${itemType.slice(0, -1)}?`)) {
                try {
                    await deleteDoc(doc(db, itemType, doc.id));
                    showToast(`${itemType.slice(0, -1)} deleted successfully.`);
                    itemDiv.remove(); 
                } catch (error) { 
                    console.error("Error deleting item:", error); showToast("Failed to delete item."); 
                }
            }
        };
        itemDiv.appendChild(deleteButton);
        container.appendChild(itemDiv);
    });
}


// --- Modal Logic ---
const modalContent = {
  privacy: { title: "Privacy Policy", text: `<p>This Privacy Policy describes how Free Earnings App (the "App", "we", "us", or "our") collects, uses, and discloses your information. Your privacy is of utmost importance to us.</p>
           <p><strong>1. Information We Collect</strong></p>
           <p>We collect information you provide directly to us when you create an account, such as your name, email address, and password. We also collect information related to your activity on the App, including tasks completed, earnings, withdrawal history, and referral information. We do not collect sensitive personal information.</p>
           <p><strong>2. How We Use Your Information</strong></p>
           <p>The information we collect is used to: </p>
           <ul><li>Operate and maintain your account.</li><li>Process transactions, including withdrawal requests.</li><li>Verify your identity to prevent fraud.</li><li>Communicate with you about your account, updates, and promotional offers.</li><li>Monitor and analyze usage and trends to improve your experience.</li></ul>
           <p><strong>3. Information Sharing and Disclosure</strong></p>
           <p>We are committed to not sharing your personal information with third parties without your consent, except in the following circumstances: </p>
           <ul><li>To comply with a legal obligation, such as a court order or government request.</li><li>To enforce our Terms of Service and protect the security and integrity of our App.</li><li>In connection with a merger, acquisition, or sale of assets.</li></ul>` },
  terms: { title: "Terms of Service", text: `<p>Welcome to Free Earnings App. By creating an account and using our services, you agree to be bound by the following terms and conditions.</p>
           <p><strong>1. User Eligibility and Account</strong></p>
           <p>You must be at least 18 years old to use this App. You are responsible for maintaining the confidentiality of your account password and for all activities that occur under your account. You agree to create only one account per person. Creating multiple accounts is a violation of our policy and will result in the termination of all associated accounts without any payment.</p>
           <p><strong>2. Prohibited Activities</strong></p>
           <ul><li>Using any automated software, bots, or scripts to complete tasks.</li><li>Creating fake or multiple accounts.</li><li>Engaging in any activity that disrupts or interferes with our services.</li></ul>
           <p><strong>3. Withdrawal Policy</strong></p>
           <p>The minimum withdrawal amount is ₹1200. All withdrawal requests are reviewed manually. We reserve the right to reject any withdrawal request if we suspect fraudulent activity or violation of our terms.</p>` },
  about: { title: "About Us", text: `<p>Welcome to Free Earnings App, your trusted platform for simple and reliable online earnings.</p>
           <p><strong>Our Mission</strong></p>
           <p>Our mission is to provide a straightforward and accessible opportunity for individuals to earn a supplementary income from the comfort of their homes. We aim to bridge the gap between businesses that need online engagement and users who are willing to provide it.</p>
           <p><strong>Our Commitment to You</strong></p>
           <p>We are committed to transparency, fairness, and reliability. We believe in building a strong, long-lasting relationship with our user community based on trust. Our dedicated support team is always available to assist you with any questions or issues.</p>` },
  taskDetails: { title: "Task Details & Earnings Guide", text: `<p>Understanding how tasks work is crucial for maximizing your income.</p>
           <p><strong>1. Types of Tasks:</strong></p>
           <ul><li><strong>Website Visits/Clicks:</strong> Most tasks involve visiting a specified website and performing certain actions.</li><li><strong>Content Engagement:</strong> This could include watching short videos or liking posts.</li></ul>
            <p><strong>2. READ INSTRUCTIONS CAREFULLY:</strong></p>
            <p>Each task comes with a clear set of instructions. It is absolutely essential to read and follow these instructions precisely to get paid.</p>
           <p><strong>3. Verification Process:</strong></p>
           <p>Our system tracks your actions to verify task completion. Tasks that are deemed incomplete or fraudulent will not be credited.</p>` },
  withdrawalProfile: { title: "Withdrawal Profile Management", text: `<p>Managing your withdrawal profile correctly is vital for receiving your earnings securely and on time.</p>
           <p><strong>1. Available Withdrawal Methods:</strong></p>
           <ul><li>Easypaisa (03435640880 - Mujtaba Hassan)</li><li>JazzCash</li><li>Pakistan Bank Transfer (Allied Bank)</li><li>Bitget (Cryptocurrency)</li><li> Payment dates are 19-22 and 28-31 of each month.</li><li> If these dates fall on weekends or holidays, payments will be processed on the nearest business day.</li><li>A two-week hold period applies after reaching the minimum payout amount.</li><li>All withdrawal requests are manually reviewed.</li></ul>
           <p><strong>2. Setting Up Your Account:</strong></p>
           <p>Ensure you provide accurate account details. Incorrect information can lead to delays or loss of funds, for which we are not responsible.</p>
           <p><strong>3. Minimum Withdrawal Amount:</strong></p>
           <p>A minimum balance of <b>₹1200</b> is required.</p>
           <p><strong>4. Processing Time:</strong></p>
           <p>All requests are manually reviewed and processed within <b>1 week to 2 weeks</b>.</p>` }
};

function openModal(type) {
  modalTitle.innerText = modalContent[type].title;
  modalText.innerHTML = modalContent[type].text;
  modal.style.display = "block";
}

// Event Listeners for Footer Links
privacyBtn.onclick = () => openModal('privacy');
termsBtn.onclick = () => openModal('terms');
aboutBtn.onclick = () => openModal('about');
taskDetailsBtn.onclick = () => openModal('taskDetails');
withdrawalProfileBtn.onclick = () => openModal('withdrawalProfile');

// Contact Links
contactEmailLink.addEventListener("click", () => {
  const userEmail = auth.currentUser ? auth.currentUser.email : 'N/A';
  const subject = "Inquiry from Free Earnings App User";
  const body = `Hello,\n\nMy Email: ${userEmail}\n\nMy Inquiry:\n`;
  window.location.href = `mailto:${adminEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
});

contactWhatsappLink.addEventListener("click", () => {
  const userEmail = auth.currentUser ? auth.currentUser.email : 'N/A';
  const prefillText = `Hello, I'm contacting you from the Free Earnings App. My Email: ${userEmail}.`;
  window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(prefillText)}`, "_blank");
});

// Modal Close Button and Outside Click
closeBtn.onclick = () => { modal.style.display = "none"; };
window.onclick = (event) => { 
    if (event.target == modal) { 
        modal.style.display = "none"; 
    } 
};

// Navigation Section Switching
document.querySelectorAll("nav button[data-section]").forEach(button => {
    button.addEventListener("click", () => {
        const sectionId = button.dataset.section;
        if (sectionId) {
            showSection(sectionId);
        }
    });
});

// Initial UI Setup on DOM Load
document.addEventListener('DOMContentLoaded', () => {
    // The onAuthStateChanged listener will handle showing the correct initial section.
});
</script>

</body>
</html>
